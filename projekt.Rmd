---
title: "Poroke in razveze v Sloveniji"
author: "Anja Trobec"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Za temo sem si izbrala poroke in razveze v Sloveniji. 
Analizirala bom podatke o številu porok po letih, o povprečni starosti ob vstopu v zakonsko zvezo, podatke o istospolnih porokah in številu porok po regijah. Poleg tega, pa bom analizirala tudi številke o razvezah letno, povprečnih trajanjih zveze in številu otrok ob izstopu iz zveze.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```
Uvozila sem podatke iz Statističnega urada Republike Slovenije.
Imam 6 tabel - vse v csv obliki, urejene v tidy data.

1. TABELA - podatki o številu skenjenih zvez letno in povprečna starost ob vstopu v zakonsko zvezo

2. TABELA - podatki o porokah po regijah
    - 'regija' - spremenljivka: poroke glede na slovenske regije
    - 'sestevek' - meritev: povprečno število porok v dotični regiji v določenem obdobju
    
3. TABELA - podatki o razvezah
    - 'leto' - spremenljivka: časovno obdobje med 1990 - 2017
    - 'kategorije' - spremenljivka: kategorije po trajanju zakonske zveze in podatki o otrokih ob razvezi
    - 'stevilo' - meritev: število razvez po kategorijah
    
4. TABELA - podatki o porokah med istospolnimi partnerji 
    - 'leto' - spremenljivka: časovno obdobje med 2007 - 2017
    - 'spol' - spremenljivka: moške ali ženske istospolne poroke
    - 'stevilo' - meritev: število porok med določenim spolom v določenem letu
    
5. TABELA - razvezani po starostnih skupinah
    - 'starost pri razvezi' - spremenljivka: razvezani glede na starost
    - 'leto' - spremenljivka: časovno obdobje med 2011 - 2018
    - 'stevilo' - meritev: število razvezanih v določenem letu
    
6. TABELA - vdoveli
    - 'starostni tip' - spremenljivka: starost vdovelega
    - 'leto' - spremenljivka: časovno obdobje med 2011 - 2018
    - 'stevilo' - meritev: število vdovelih


<!-- Spodnji graf prikazuje porazdelitev števila naselij v občinah. -->

<!-- ```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'} -->
<!-- ggplot(obcine, aes(x=naselja)) + geom_histogram() + -->
<!--   ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin") -->
<!-- ``` -->

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnja 2 grafa prikazujeta povprečno trajanje zakonske zveze do ločitve. 
Situacijo sem želela predstaviti v dveh oblikah, da še procentualno vidimo kaj pomenijo te številke.

```{r trajanje, echo=FALSE, message=FALSE, fig.align='center'}
print(trajanje)
```

```{r graf, echo=FALSE, message=FALSE, fig.align='center'}
print(graf)
```


Preučila sem tudi podatke o istospolnih porokah med moškimi in med ženskami v Sloveniji.
Spodnji graf prikazuje število istospolnih porok med letoma 2007 - 2017.

```{r istospolne, echo=FALSE, message=FALSE, fig.align='center'}
print(istospolne)
```


Razveze sem analizirala po starostnih skupinah od leta 2011 - 2017. Ugotovila sem, da so razveze najbolj pogoste med petdesetim in šestdesetim letom.

```{r starost, echo=FALSE, message=FALSE, fig.align='center'}
print(starost)
```

Pri razvezah pa me je zanimalo še, ali sta partnerja starša ali ne. Spodnji graf prikazuje število ločitev pri katerih so partnerji starši otrok in ločitve pri katerih partnerji nimajo otrok.

```{r otroki, echo=FALSE, message=FALSE, fig.align='center'}
print(otroki)
```












Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```








***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

```
